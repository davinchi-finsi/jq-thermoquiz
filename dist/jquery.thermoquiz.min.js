/**
 * @license jq-thermoquiz v1.0.0
 * (c) 2020 Finsi, Inc. Credits to @davedupplaw for jq-thermometer
 */

!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t,i;t=jQuery,i={setValue:function(t){t>=this.options.maxValue?this.valueToAttain=this.options.maxValue:t<=this.options.minValue?this.valueToAttain=this.options.minValue:this.valueToAttain=t,this._update()},setTextColour:function(t){this._updateTextColour(t)},setTickColour:function(t){this._updateTickColour(t)},setTopText:function(t){this.topText.find("tspan").text(t)},setBottomText:function(t){this.bottomText.find("tspan").text(t)},setLiquidColour:function(t){this.options.liquidColour=t,this._updateLiquidColour()},getLiquidColour:function(){return t.isFunction(this.options.liquidColour)?this.options.liquidColour(this.currentValue):this.options.liquidColour},_updateLiquidColour:function(){var t=this.getLiquidColour(),i=[];i.colour=t,i.darkColour=this._blendColors(t,"#000000",.1),i.veryDarkColour=this._blendColors(t,"#000000",.2),this._formatDataAttribute(this.neckLiquid,"style",i),this._formatDataAttribute(this.liquidTop,"style",i),this._formatDataAttribute(this.bowlLiquid,"style",i),this._formatDataAttribute(this.bowlGlass,"style",i),this._formatDataAttribute(this.neckGlass,"style",i)},_updateTextColour:function(t){this.options.textColour=t;var i={textColour:this.options.textColour};this._formatDataAttribute(this.topText,"style",i),this._formatDataAttribute(this.bottomText,"style",i)},_updateTickColour:function(t){this.options.tickColour=t;var i={tickColour:this.options.tickColour},e=this;this.ticks.find("rect").each((function(t,o){e._formatDataAttribute(o,"style",i)}))},_setupSVGLinks:function(i){var e=this.fixtureId;i.find("g[id], g [id]").each((function(i,o){t(o).attr("id",e+"_"+t(o).attr("id"))})),this.liquidBottomY=346,this.liquidTopY=25,this.neckBottomY=573,this.neckTopY=250,this.neckMinSize=30,this.svgHeight=1052,this.leftOffset=300,this.topOffset=150,this.liquidTop=t("#"+e+"_LiquidTop path"),this.neckLiquid=t("#"+e+"_NeckLiquid path"),this.bowlLiquid=t("#"+e+"_BowlLiquid path"),this.topText=t("#"+e+"_TopText"),this.bottomText=t("#"+e+"_BottomText"),this.bowlGlass=t("#"+e+"_BowlGlass"),this.neckGlass=t("#"+e+"_NeckGlass"),this.ticks=t("#"+e+"_Ticks")},_create:function(){var i=this,e=t("<div/>");this.div=e,this.element.append(e),this.fixtureId=this.element.attr("id"),e.load(this.options.pathToSVG,null,(function(){var e=t(this).find("svg");i._setupSVGLinks(e),e[0].setAttribute("preserveAspectRatio",i.options.preserveAspectRatio),e[0].setAttribute("viewBox",i.options.viewBox(i)),e.attr("width",i.options.width),e.attr("height",i.options.height),i.currentValue=i.options.startValue,i.setValue(i.options.startValue),i.setTopText(i.options.topText),i.setBottomText(i.options.bottomText),i.setLiquidColour(i.options.liquidColour),i.setTextColour(i.options.textColour),i.setTickColour(i.options.tickColour),i.options.horizontal&&(e.css("transform","rotate(90deg)"),i.options.adjustTopTextHorizontal(i.topText),i.options.adjustBottomTextHorizontal(i.bottomText)),i.options.onLoad&&i.options.onLoad()}))},_update:function(){var i=this,e={val:this.currentValue};t(e).animate({val:this.valueToAttain},{duration:this.options.animationSpeed,step:function(){i._updateViewToValue(this.val),i.currentValue=this.val}})},_updateViewToValue:function(i){t.isFunction(this.options.liquidColour)&&this._updateLiquidColour();var e=[];e.liquidY=this.liquidBottomY-(i-this.options.minValue)*(this.liquidBottomY-this.liquidTopY)/(this.options.maxValue-this.options.minValue),e.neckPosition=(i-this.options.minValue)*(this.neckBottomY-this.neckTopY)/(this.options.maxValue-this.options.minValue)+this.neckMinSize,e.boxPosition=this.neckBottomY-e.neckPosition,this._formatDataAttribute(this.liquidTop,"transform",e),this._formatDataAttribute(this.neckLiquid,"d",e),this.options.valueChanged&&this.options.valueChanged(i)},_formatDataAttribute:function(i,e,o){var s=t(i).attr("data-"+e);for(var n in o)s=s.replace(new RegExp("%%"+n+"%%","g"),o[n]);t(i).attr(e,s)},_blendColors:function(t,i,e){var o=parseInt(t.slice(1),16),s=parseInt(i.slice(1),16),n=o>>16,a=o>>8&255,r=255&o,h=s>>16,l=s>>8&255,u=255&s;return"#"+(16777216+65536*(Math.round((h-n)*e)+n)+256*(Math.round((l-a)*e)+a)+(Math.round((u-r)*e)+r)).toString(16).slice(1)},options:{horizontal:!1,adjustTopTextHorizontal:function(t){t.css({"transform-origin":"center","text-anchor":"middle",transform:"rotate(-90deg) translate(-150px, 305px)"})},adjustBottomTextHorizontal:function(t){t.css({"transform-origin":"center","text-anchor":"middle",transform:"rotate(-90deg) translate(-460px, -25px)"})},height:700,minValue:0,maxValue:8,startValue:0,topText:8,bottomText:0,textColour:"#000000",tickColour:"#000000",liquidColour:"#ff0000",animationSpeed:1e3,pathToSVG:"svg/thermo-bottom.svg",viewBox:function(t){return t.leftOffset+" "+t.topOffset+" 744 600"},preserveAspectRatio:"xMinYMin meet",valueChanged:void 0,onLoad:void 0}},t.widget("dd.thermometer",i),function(t){t.widget("ui.thermoQuiz",{NAMESPACE:"thermoQuiz",_$thermometer:null,_$thermometerBackup:null,_$optionsContainer:null,_$checkAnswerButton:null,_$options:null,_options:null,_$feedbackContainer:null,_feedback:null,_currentScore:0,_selectedOptions:[],ON_OPTION_CHANGE:"thermoQuizOptionChange",ON_CHECK_ANSWERS:"thermoQuizCheckAnswers",options:{value:0,minValue:0,maxValue:10,topText:10,bottomText:0,horizontal:!1,classes:{root:"jq-thermoquiz",horizontal:"jq-thermoquiz--horizontal",completed:"jq-thermoquiz--completed",disabled:"jq-thermoquiz--disabled",checked:"jq-thermoquiz--checked"}},_create:function(){this.element.addClass(this.options.classes.root),this.element.uniqueId(),this.options.disabled&&this.element.addClass(this.options.classes.disabled),this.options.horizontal&&this.element.addClass(this.options.classes.horizontal),this._initialize()},_initialize:function(){var t=this;this._$checkAnswerButton=this.element.find("[data-thermoquiz-check]"),this._$checkAnswerButton.on("click."+this.NAMESPACE,(function(){t.checkAnswers.call(t,null)})),this.options.disabled&&this._$checkAnswerButton.prop("disabled",!0),this._initializeFeedback(),this._initializeOptions(),this._initializeThermometer()},_initializeThermometer:function(){this._$thermometer&&(this._$thermometer.after(this._$thermometerBackup),this._$thermometer.remove()),this._$thermometer=this.element.find("[data-thermoquiz-thermometer]"),this._$thermometerBackup=this._$thermometer.clone();var i=t.extend(!0,{},this.options.thermometer||{},{horizontal:this.options.horizontal,startValue:this.options.value,minValue:this.options.minValue,maxValue:this.options.maxValue,topText:this.options.topText,bottomText:this.options.bottomText});this._$thermometer.thermometer(i)},_initializeOptions:function(){this._$optionsContainer=this.element.find("[data-thermoquiz-options]"),this._$optionsContainer.off("."+this.NAMESPACE),this._$options=this._$optionsContainer.find("[data-thermoquiz-option]"),this.options.disabled&&this._$options.prop("disabled",!0);var i=Array.from(this._$options);this._options=i.map((function(i,e){var o=t(i),s=parseFloat(o.data("thermoquizOption"));return{index:e,element:i,$element:o,value:s}}));var e=this;this._$optionsContainer.on("change."+this.NAMESPACE,(function(t){e._onOptionChange.call(e,t)}))},_onOptionChange:function(t){var i=t.target,e=this._options.find((function(t){return t.element==i}));if(e){if(i.checked)e.$element.addClass(this.options.classes.checked),-1==this._selectedOptions.findIndex((function(t){return t.element==i}))&&this._selectedOptions.push(e);else{e.$element.removeClass(this.options.classes.checked);var o=this._selectedOptions.findIndex((function(t){return t.element==i}));-1!=o&&this._selectedOptions.splice(o,1)}this.element.trigger(this.ON_OPTION_CHANGE,[this,e])}},_initializeFeedback:function(){this._$feedbackContainer=this.element.find("[data-thermoquiz-feedback]");var i=this._$feedbackContainer.find("[data-thermoquiz-feedback-item]");this._$feedback=i;var e=Array.from(i);i.detach(),this._feedback=e.map((function(i,e){var o=t(i),s=o.data("thermoquizFeedbackItem").split(","),n=parseFloat(s[0]);return{index:e,min:parseFloat(s[1]),max:n,element:i,$element:o}}))},_disableInteractions:function(){this._$checkAnswerButton.addClass(this.options.classes.disabled).prop("disabled",!0),this._$options.addClass(this.options.classes.disabled).prop("disabled",!0)},_enableInteractions:function(){this._$checkAnswerButton.removeClass(this.options.classes.disabled).prop("disabled",!1),this._$options.removeClass(this.options.classes.disabled).prop("disabled",!1)},reset:function(){this._selectedOptions=[],this._enableInteractions(),this._initializeThermometer(),this._$options.prop("checked",!1),this._$feedback.detach(),this.element.removeClass(this.options.classes.completed)},checkAnswers:function(){var t=this;this._disableInteractions();var i=this.options.value+this._selectedOptions.reduce((function(t,i){return t+i.value}),0);i>this.options.maxValue?i=this.options.maxValue:i<this.options.minValue&&(i=this.options.minValue),this._$thermometer.thermometer("setValue",i);var e=this._feedback.filter((function(t){return i>=t.min&&i<=t.max}));e.forEach((function(i){i.$element.appendTo(t._$feedbackContainer)})),this.element.addClass(this.options.classes.completed),this.element.trigger(this.ON_CHECK_ANSWERS,[this,i,e])},destroy:function(){this.element.removeClass(this.options.classes.root),this.element.removeClass(this.options.classes.completed),this.element.removeClass(this.options.classes.disabled),this._$options.removeClass(this.options.classes.disabled),this._$options.off("."+this.NAMESPACE),this._$checkAnswerButton.off("."+this.NAMESPACE),this._$thermometer.after(this._$thermometerBackup),this._$thermometer.remove(),this._super()},disable:function(){this.element.addClass(this.options.classes.disabled),this._disableInteractions(),this._super()},enable:function(){this.element.removeClass(this.options.classes.disabled),this._enableInteractions(),this._super()}})}(jQuery)}));
